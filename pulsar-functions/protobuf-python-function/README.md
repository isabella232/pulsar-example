These steps will help you reproduce how to load Python Pulsar function with protobuf that can receive a protobuf message and pushed to a sink topic where can be verified by a Pulsar reader.

### Software versions
The steps are verified on these versioning lineup.

#### Dev machine
- Centos 7
- Python 2.7.5
- Protobuf 3.10.0
- protoc - libprotoc 2.5.0

#### Pulsar
- Pulsar [2.4.2 with kafkaesque fixes](https://github.com/kafkaesque-io/pulsar/tree/kesque_2.4.2)
- Python 2.7.14
- Protobuf 3.11.1

The good news is protobuf already installed on Pulsar function worker's container.

### Proto file
We use the same example of addressbook in [Google's Python protocol buffer Python tutorial](https://developers.google.com/protocol-buffers/docs/pythontutorial).

Following the Google example, `protoc` generates a `addressbook_pb2.py` in your specified destination directory. Unlike original Python for import as a library, we will directly modify and load the file as Python Pulsar function.

Chris and I discussed to use SerDe of Python function. I think it requires more hacking so this might be explored in the future.

### Pulsar Python Function
An example of [addressbook_pb2.py](.addressbook_pb2.py) in this folder unmarshals protobuf string to ~AddressBook~ object and return the id to the next sink topic.

When the Python file is uploaded, make sure sepcify addressbook_pb2.ConfigBasedAppendFunction. I used [kafkaesque.io](https://kafkaesque.io/dashboard/#/admin/functions/view/useast2-aws:ming-luo:local-useast2-aws:addressbook_pb2) to upload the function. I did not test `pulsar-admin` [cli](https://pulsar.apache.org/docs/en/functions-deploying/#triggering-pulsar-functions) to upload a function but which is the same steps taken by kafkaesque.io's backend.

### Produce and verify protobuf message
I created two topics for function to receive and sink messages for verification.

[producer.py](./producer.py) imports the *original addressbook_pb2.py* for marshalling and generates a message which can be consumed the function. I use a [reader.py](./reader.py) to verify the id generated by the producer which in turn is decoded and forwarded by the function.

PLEASE NOTE: use the original addressbook_pb2.py generated by protoc for the producer.

